generator client {
  provider   = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  TEACHER
  STUDENT
}

model User {
  id              Int          @id @default(autoincrement())
  name            String
  email           String       @unique
  role            Role         @default(STUDENT)
  hashed_password String?
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt

  classrooms      Classroom[]  @relation("TeacherClassrooms")
  enrollments     Enrollment[] @relation("StudentEnrollments")
}

model Classroom {
  id          Int           @id @default(autoincrement())
  class_code  String        @unique
  name        String
  description String?       @db.Text
  teacher_id  Int
  created_at  DateTime      @default(now())
  updated_at  DateTime      @updatedAt

  teacher     User          @relation("TeacherClassrooms", fields: [teacher_id], references: [id])
  enrollments Enrollment[]  @relation("ClassEnrollments")
  sections    Section[]     @relation("ClassroomSections")
}

model Enrollment {
  id           Int        @id @default(autoincrement())
  student_id   Int
  classroom_id Int
  enrolled_at  DateTime   @default(now())

  student      User       @relation("StudentEnrollments", fields: [student_id], references: [id])
  classroom    Classroom  @relation("ClassEnrollments", fields: [classroom_id], references: [id])

  @@unique([student_id, classroom_id])
}

model Section {
  id            Int          @id @default(autoincrement())
  classroom_id  Int
  title         String
  position      Int

  classroom     Classroom   @relation("ClassroomSections", fields: [classroom_id], references: [id])
  assignments   Assignment[]

  @@unique([classroom_id, order])
}

model Assignment {
  id            Int          @id @default(autoincrement())
  section_id    Int
  title         String
  description   String       @db.Text
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt

  section       Section      @relation(fields: [section_id], references: [id])
  challenges    CodingChallenge[]
}

model CodingChallenge {
  id              Int          @id @default(autoincrement())
  assignment_id   Int
  title           String
  starter_code    String       @db.Text
  language        String
  created_at      DateTime     @default(now())
  updated_at      DateTime     @updatedAt

  assignment      Assignment   @relation(fields: [assignment_id], references: [id])
  test_cases      TestCase[]
}

model TestCase {
  id                Int          @id @default(autoincrement())
  challenge_id      Int
  input             String       @db.Text
  expected_output   String       @db.Text
  is_hidden         Boolean      @default(false)
  created_at        DateTime     @default(now())

  challenge         CodingChallenge @relation(fields: [challenge_id], references: [id])
}
